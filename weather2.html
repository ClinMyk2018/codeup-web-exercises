<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minimalist Weather Map Project</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet'/>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <link rel='stylesheet'
          href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css'
          type='text/css'/>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

</head>
<body>

<h1>Weather Map</h1>


<div class="row mx-auto">
    <div class="column-lg-6">
        <div class="card">
            <div class="container">
                <div class="currentSA">
<!--                    <h3>77.06/70.8</h3>-->
<!--&lt;!&ndash;                    <img class="mx-auto">&ndash;&gt;-->
<!--                    <h5>Clouds: 0.94</h5>-->
<!--                    <h5>Humidity: 0.89</h5>-->
<!--                    <h5>Wind: 27.87</h5>-->
<!--                    <h5>Pressure: 1010.27</h5>-->
                </div>
            </div>
        </div>
    </div>
    <div class="column-lg-6">
        <div id='map' style="height: 40rem; width: 60rem;"></div>
        <pre id='coordinates' class='coordinates'></pre>
    </div>
</div>


<script
        src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous">
</script>

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js'></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src="js/keys.js"></script>

<script>

    // Global Variables

    const corsUrl = 'https://cors-anywhere.herokuapp.com/';
    const darkSkyUrl = "https://api.darksky.net/forecast/";
    const darkSkyApi = ykSkraD;
    const accessToken = yeKxoBpaM;

var lat = 29.4241;
var lng = -98.4936;


var lang = '?lang=eo';

var seconds = 1556720525;

var dateObject = new Date(seconds * 1000);
console.log(dateObject.toString());


var icons = {
"clear-day": "icon/SVG/Sun.svg",
"clear-night": "icon/SVG/Moon-Full.svg",
"rain": "icon/SVG/Cloud-Rain.svg",
"snow": "icon/SVG/Cloud-Snow.svg",
"sleet": "icon/SVG/Cloud-Hail.svg",
"wind": "icon/SVG/Wind.svg",
"fog": "icon/SVG/Cloud-Fog-Alt.svg",
"cloudy": "icon/SVG/Cloud.svg",
"partly-cloudy-day": "icon/SVG/Cloud-Sun.svg",
"partly-cloudy-night": "icon/SVG/Cloud-Moon.svg"
};

function postsHtml(posts) {

var html = '';
var i;


for (i = 0; i <= 2; i++) {
html += '<div class="currentSA">';
    html += '<h4>' + posts.daily.data[i].temperatureHigh + "/";
        html += posts.daily.data[i].temperatureLow + '<img src="' + icons[posts.daily.data[i].icon] + '"></h4>';
    // html += '<img src="' + icons[posts.daily.data[i].icon] + '">';
    html += '<h6>Clouds: ' + posts.daily.data[i].cloudCover + '</h6>';
    html += '<h6>Humidity: ' + posts.daily.data[i].humidity + '</h6>';
    html += '<h6>Wind: ' + posts.daily.data[i].windGust + '</h6>';
    html += '<h6>Pressure: ' + posts.daily.data[i].pressure + '</h6>';
    html += '</div>';
}

return html;
}

$.get(corsUrl + darkSkyUrl + darkSkyApi + "/" + lat + "," + lng + "/" + lang, {
daily: {
data: {
temperatureHigh: "",
temperatureLow: "",
cloudCover: "",
humidity: "",
windGust: "",
pressure: ""
}
}

}).done(function (data) {
console.log(data);
$('.currentSA').html(postsHtml(data));
});


mapboxgl.accessToken = accessToken;


var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/nadbot/cjv5l7j4a1k1l1fqof618dtg2',
center: [-98.4916, 29.4252],
zoom: 4
});

map.addControl(new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
marker: false
}).on('result', function (data) {
marker.setLngLat(data.result.center);
onDragEnd();
})
);

var marker = new mapboxgl.Marker({
draggable: true,
})
.setLngLat([-98.4916, 29.4252])
.addTo(map);


function onDragEnd() {
var lngLat = marker.getLngLat();

$.get(corsUrl + darkSkyUrl + darkSkyApi + "/" + lngLat.lat + "," + lngLat.lng + "/" + lang, {
daily: {
data: {
temperatureHigh: "",
temperatureLow: "",
cloudCover: "",
humidity: "",
windGust: "",
pressure: ""
}
}

}).done(function (data) {
console.log(data);
$('.currentSA').html(postsHtml(data));
});
}

marker.on('dragend', onDragEnd);

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>